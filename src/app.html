<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon-192x192.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>ControlForge Systems</title>
		
		<!-- Google Tag Manager - Ultra-optimized for performance -->
		<script>
			window.dataLayer = window.dataLayer || [];
			
			// Ultra-deferred GTM loading - only load on meaningful user interaction
			let gtmLoaded = false;
			function loadGTM() {
				if (gtmLoaded) return;
				gtmLoaded = true;
				
				const gtmScript = document.createElement('script');
				gtmScript.async = true;
				gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-K8HFFCM6';
				document.head.appendChild(gtmScript);
				
				window.dataLayer.push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
			}
			
			// Only load GTM after significant delay or meaningful interaction
			function initGTMLoader() {
				// Load after 3 seconds of page being loaded AND idle
				setTimeout(() => {
					if (document.readyState === 'complete') {
						requestIdleCallback ? requestIdleCallback(loadGTM, { timeout: 5000 }) : loadGTM();
					}
				}, 3000);
				
				// Load on meaningful user interactions only
				['click', 'touchstart', 'keydown'].forEach(function(event) {
					document.addEventListener(event, () => {
						setTimeout(loadGTM, 1000); // Still delay even on interaction
					}, { once: true, passive: true });
				});
			}
			
			// Initialize the loader
			if (document.readyState === 'complete') {
				initGTMLoader();
			} else {
				window.addEventListener('load', initGTMLoader);
			}
		</script>
		<!-- End Google Tag Manager -->
		
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8HFFCM6"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->
		
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>